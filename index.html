<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge"> 

        <!-- mdl -->
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
        
        <!-- demo css -->
        <link rel="stylesheet" type="text/css" href="./demo.css">

        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

        <title>Canvas editor</title>
    </head>
    <body>
        <h2>Canvas editor</h2>
       
        <div class="demo-image-canvas"></div>
        
        <div class="mdl-grid">

            <div class="demo-sliders mdl-cell--4-col-phone mdl-cell--6-col mdl-cell--1-offset-tablet mdl-cell--3-offset-desktop">            
                <div class="demo-slider-group mdl-grid">
                    <i class="material-icons"> brightness_low </i> 
                    <input class="editor-change mdl-slider mdl-js-slider" type="range" min="-1" max="1" step="0.01" id="brighteness">
                    <!-- <span class="js-slider-value">20</span>         -->
                </div>
    
                <div class="demo-slider-group mdl-grid">
                    <i class="material-icons"> color_lens </i> <!-- format_color -->
                    <input class="editor-change mdl-slider mdl-js-slider" type="range" min="-1" max="1" step="0.01" id="saturation">
                    <!-- <span class="js-slider-value">20</span>         -->
                </div>
    
                <div class="demo-slider-group mdl-grid">
                    <i class="material-icons"> exposure </i> 
                    <input class="editor-change mdl-slider mdl-js-slider" type="range" min="-1" max="1" step="0.01" id="contrast">
                    <!-- <span class="js-slider-value">20</span>         -->
                </div>
                
            </div>
        </div>
        
        <select class="transformMethods"></select>

        <h3>Images</h3>

        <div class="image-loader-preview demo-image-grid mdl-grid"></div>

        <button class="demo-fab mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored">
            <div class="demo-file-wrapper">
                <label for="image-file"></label>
                <input id="image-file" type="file" multiple class="demo-fab__input demo-file-input" />
            </div>            
            
            <i class="material-icons">insert_drive_file</i>
        </button>


        <script type="module">
            import ImageEditor from './ImageEditor.js'
            const myEditor = new ImageEditor('.demo-image-canvas')
                  myEditor.setImage('./img.jpg')

            window.editor = myEditor

            document.querySelectorAll('.editor-change').forEach( slider => {
                slider.addEventListener('input', (e) => {
                    const element = e.target

                    myEditor.updateOption(element.getAttribute('id'), Number.parseFloat(element.value))
                })
            })

            const select = document.querySelector('.transformMethods')

            myEditor.getTransformMethods().forEach( tfMethod => {
                const method = document.createElement('option')
                      method.value = method.innerHTML = tfMethod
                      select.appendChild(method)
            })

            select.addEventListener('change', (e) => {
                myEditor.setTransformMethod(e.target.value)
            })

            window.myEditor = myEditor
        </script>

        <script src="./ImageLoader.js"></script>

        <script>
            const iu = new ImageLoader('#image-file')
            const imageContainer = document.querySelector('.image-loader-preview')

            iu.on('load', (img, e, reader) => {

                const preview = document.createElement('div')
                      preview.classList.add('demo-card-image', 'mdl-card', 'mdl-shadow--2dp', 'mdl-cell')
                      preview.style.backgroundImage = `url(${img})`

                      preview.innerHTML = `
                      <div class="mdl-card__title mdl-card--expand"></div>
                        <div class="mdl-card__actions">
                        <span class="demo-card-image__filename">${e.name}</span>
                        </div>
                      </div>
                      `

                      preview.addEventListener('click', () => { editor.setImage(img) })

                imageContainer.appendChild(preview)

                editor.setImage(img)
            })
        </script>
    </body>
</html>